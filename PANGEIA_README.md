# ü§ñ Pangeia - Agente Conversacional de Gest√£o de Tarefas

Sistema completo de gest√£o de tarefas via WhatsApp com hierarquia de equipe (l√≠deres e encarregados).

## üìã √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Caracter√≠sticas](#caracter√≠sticas)
- [Instala√ß√£o](#instala√ß√£o)
- [Comandos do WhatsApp](#comandos-do-whatsapp)
- [API REST](#api-rest)
- [Arquitetura](#arquitetura)
- [Exemplos de Uso](#exemplos-de-uso)

## üéØ Vis√£o Geral

O **Pangeia** √© um agente conversacional inteligente integrado ao WhatsApp que permite gerenciar tarefas de equipe de forma natural e intuitiva. Voc√™ pode criar tarefas, atribuir membros, acompanhar progresso e gerar relat√≥rios - tudo atrav√©s de mensagens do WhatsApp!

### Principais Funcionalidades

‚úÖ **Gest√£o de Tarefas Completa**
- Criar, listar, atualizar e concluir tarefas
- Prioriza√ß√£o (Baixa, M√©dia, Alta, Urgente)
- Status (Pendente, Em Progresso, Conclu√≠da, Cancelada, Em Espera)
- Prazos e alertas de atraso
- Coment√°rios e hist√≥rico

üë• **Hierarquia de Equipe**
- L√≠deres: T√™m vis√£o completa e podem gerenciar tudo
- Encarregados: Membros regulares da equipe
- Cadastro autom√°tico ao interagir com o bot

üìä **Relat√≥rios e Estat√≠sticas**
- Estat√≠sticas por equipe e por membro
- Tarefas em atraso
- Progresso e conclus√£o

üîî **Notifica√ß√µes Inteligentes**
- Notifica√ß√£o de l√≠deres sobre novas tarefas
- Lembretes de tarefas pendentes

üß† **IA Conversacional (NOVO!)**
- Entende linguagem natural sem comandos fixos
- Aprende com o contexto da conversa
- Suporte para m√∫ltiplos provedores de IA (OpenAI, Anthropic, Groq, Local)
- Respostas personalizadas e naturais
- Mem√≥ria de conversa√ß√£o
- Fallback inteligente para regex quando IA n√£o est√° dispon√≠vel

## üß† IA Conversacional

O Pangeia agora conta com **IA Generativa** para entender comandos de forma muito mais natural e flex√≠vel!

### Como Funciona

**SEM IA (modo regex):**
```
Usu√°rio: "criar tarefa Revisar c√≥digo"
```

**COM IA (modo natural):**
```
Usu√°rio: "preciso que algu√©m revise o c√≥digo do backend"
Pangeia: ‚úÖ Tarefa criada! #15 - Revisar c√≥digo do backend

Usu√°rio: "atribui pra Maria"
Pangeia: ‚úÖ Tarefa #15 atribu√≠da a Maria Santos!

Usu√°rio: "qual o status dela?"
Pangeia: üìã #15 - Revisar c√≥digo do backend
         ‚è≥ Status: Pendente
         üë§ Atribu√≠da a: Maria Santos
```

### Provedores Suportados

1. **OpenAI GPT** (Recomendado para produ√ß√£o)
   - Modelos: gpt-4o, gpt-4o-mini, gpt-3.5-turbo
   - Melhor qualidade de compreens√£o
   - Custo: Pago por token

2. **Anthropic Claude** (Alternativa premium)
   - Modelos: claude-3-5-sonnet, claude-3-haiku
   - Excelente racioc√≠nio
   - Custo: Pago por token

3. **Groq** (Recomendado para testes - GRATUITO!)
   - Modelos: llama-3.1-70b-versatile, mixtral-8x7b
   - Ultra r√°pido (at√© 10x mais r√°pido)
   - Custo: **GRATUITO** (com limites)
   - Ideal para desenvolvimento

4. **Local/Ollama** (100% Privado)
   - Rode sua pr√≥pria IA localmente
   - Modelos: llama3, mistral, phi, etc
   - Custo: Gr√°tis, mas precisa de hardware

### Configura√ß√£o R√°pida

#### Op√ß√£o 1: Groq (Gratuito e R√°pido) ‚ö°

1. Crie conta em [console.groq.com](https://console.groq.com)
2. Gere uma API key
3. Adicione no `.env`:

```bash
PANGEIA_AI_PROVIDER=groq
PANGEIA_AI_API_KEY=gsk_...
PANGEIA_AI_MODEL=llama-3.1-70b-versatile
```

#### Op√ß√£o 2: OpenAI (Melhor Qualidade) üéØ

1. Crie conta em [platform.openai.com](https://platform.openai.com)
2. Adicione cr√©ditos e gere API key
3. Adicione no `.env`:

```bash
PANGEIA_AI_PROVIDER=openai
PANGEIA_AI_API_KEY=sk-proj-...
PANGEIA_AI_MODEL=gpt-4o-mini
```

#### Op√ß√£o 3: Anthropic Claude üß†

```bash
PANGEIA_AI_PROVIDER=anthropic
PANGEIA_AI_API_KEY=sk-ant-...
PANGEIA_AI_MODEL=claude-3-5-sonnet-20241022
```

#### Op√ß√£o 4: Ollama (Local e Gratuito) üè†

1. Instale Ollama: [ollama.com](https://ollama.com)
2. Baixe um modelo: `ollama pull llama3`
3. Configure:

```bash
PANGEIA_AI_PROVIDER=local
PANGEIA_AI_API_KEY=http://localhost:11434/api/chat
PANGEIA_AI_MODEL=llama3
```

### Configura√ß√£o Avan√ßada

Copie `.env.pangeia.example` para `.env` e configure:

```bash
# Provider
PANGEIA_AI_PROVIDER=groq

# API Key
PANGEIA_AI_API_KEY=sua_api_key_aqui

# Modelo (opcional - cada provider tem padr√£o)
PANGEIA_AI_MODEL=llama-3.1-70b-versatile

# Temperatura (0.0 - 1.0) - controla criatividade
PANGEIA_AI_TEMPERATURE=0.7

# M√°ximo de tokens na resposta
PANGEIA_AI_MAX_TOKENS=500
```

### Compara√ß√£o de Provedores

| Provider | Custo | Velocidade | Qualidade | Privacidade | Recomendado Para |
|----------|-------|------------|-----------|-------------|------------------|
| **Groq** | ‚≠ê Gr√°tis | ‚ö°‚ö°‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Desenvolvimento |
| **OpenAI** | üí∞ Pago | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Produ√ß√£o |
| **Claude** | üí∞ Pago | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Produ√ß√£o Premium |
| **Ollama** | ‚≠ê Gr√°tis | ‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | M√°xima Privacidade |

### Recursos da IA

‚ú® **Compreens√£o Contextual**
- Entende refer√™ncias ("ela", "essa tarefa", "√∫ltima")
- Mant√©m contexto das √∫ltimas 10 mensagens
- Lembra das tarefas recentes do usu√°rio

‚ú® **Flexibilidade de Comandos**
- "preciso criar uma task pra revisar docs" ‚úÖ
- "quais s√£o as minhas coisas pendentes?" ‚úÖ
- "finaliza a 5" ‚úÖ
- "atribui pro Jo√£o" ‚úÖ

‚ú® **Respostas Naturais**
- Respostas personalizadas baseadas no contexto
- Tom amig√°vel e motivador
- Sugest√µes proativas

‚ú® **Sistema H√≠brido Inteligente**
- Se a IA falhar, usa regex automaticamente
- Se confian√ßa for baixa (<60%), usa regex
- Zero downtime, sempre funciona!

### Testando a IA

```
# Comando tradicional (funciona sempre)
/pangeia criar tarefa Revisar documenta√ß√£o

# Com IA (mais natural)
/pangeia preciso que algu√©m revise a documenta√ß√£o
/pangeia cria uma task pra revisar os docs
/pangeia adiciona: revisar documenta√ß√£o do projeto
```

Todos funcionam! A IA entende a inten√ß√£o. üéØ

### Logs da IA

Quando a IA est√° ativa, voc√™ ver√° logs no console:

```
[Pangeia] IA ativada com provider: groq
[Pangeia AI] Intent: create_task, Confidence: 0.95
```

Quando usa fallback:

```
[Pangeia AI] Baixa confian√ßa (0.45), usando fallback regex
```

### Desativando a IA

Se preferir usar apenas regex patterns (sem IA), simplesmente **n√£o configure** as vari√°veis de ambiente do Pangeia. O sistema funciona perfeitamente sem IA!

## üöÄ Instala√ß√£o

### 1. Executar Migra√ß√£o do Banco de Dados

```bash
# Aplicar migra√ß√£o
npx prisma migrate deploy

# OU se preferir, executar manualmente o SQL
psql -U seu_usuario -d seu_banco -f prisma/migrations/20251024_add_pangeia_task_management/migration.sql
```

### 2. Gerar Cliente Prisma

```bash
npx prisma generate
```

### 3. Reiniciar o Servidor

```bash
npm run dev
# ou
npm start
```

## üí¨ Comandos do WhatsApp

Para usar o agente, inicie suas mensagens com `/pangeia` seguido do comando.

### üìã Tarefas

#### Criar Tarefa
```
/pangeia criar tarefa Revisar documenta√ß√£o do projeto
/pangeia nova tarefa Preparar apresenta√ß√£o para cliente
```

#### Listar Tarefas
```
/pangeia listar tarefas
/pangeia listar tarefas pendentes
/pangeia listar tarefas em andamento
/pangeia listar tarefas conclu√≠das
```

#### Minhas Tarefas
```
/pangeia minhas tarefas
```

#### Iniciar Tarefa
```
/pangeia iniciar tarefa #5
/pangeia come√ßar tarefa #3
```

#### Concluir Tarefa
```
/pangeia concluir tarefa #5
/pangeia completar tarefa #8
```

#### Ver Detalhes
```
/pangeia detalhes tarefa #5
/pangeia ver tarefa #3
```

#### Atribuir Tarefa
```
/pangeia atribuir tarefa #5 para Jo√£o
/pangeia assign tarefa #3 para Maria
```

#### Comentar em Tarefa
```
/pangeia comentar tarefa #5 Revisei e aprovei o c√≥digo
/pangeia comment tarefa #3 Precisa de mais testes
```

#### Definir Prioridade
```
/pangeia prioridade tarefa #5 alta
/pangeia priority tarefa #3 urgente
```

### üë• Equipe

#### Listar Membros
```
/pangeia membros
/pangeia equipe
```

#### Listar L√≠deres
```
/pangeia l√≠deres
/pangeia leaders
```

### üìä Relat√≥rios

#### Relat√≥rio da Equipe
```
/pangeia relat√≥rio
/pangeia stats
```

#### Tarefas Atrasadas
```
/pangeia atrasadas
/pangeia overdue
```

### ‚ùì Ajuda

```
/pangeia ajuda
/pangeia help
/pangeia ?
```

## üåê API REST

Al√©m do WhatsApp, voc√™ pode usar a API REST para integra√ß√£o com outros sistemas.

### Base URL
```
http://seu-servidor:8084/pangeia
```

### Endpoints Principais

#### Equipes

```http
# Criar equipe
POST /pangeia/teams
{
  "name": "Pangeia",
  "description": "Equipe principal"
}

# Listar equipes
GET /pangeia/teams

# Obter equipe
GET /pangeia/teams/:teamId

# Atualizar equipe
PUT /pangeia/teams/:teamId

# Deletar equipe
DELETE /pangeia/teams/:teamId
```

#### Membros

```http
# Adicionar membro
POST /pangeia/teams/:teamId/members
{
  "whatsappJid": "5511999999999@s.whatsapp.net",
  "name": "Jo√£o Silva",
  "role": "LEADER" | "ASSIGNED"
}

# Listar membros
GET /pangeia/teams/:teamId/members?role=LEADER

# Atualizar membro
PUT /pangeia/members/:memberId

# Remover membro
DELETE /pangeia/members/:memberId
```

#### Tarefas

```http
# Criar tarefa
POST /pangeia/teams/:teamId/tasks
{
  "title": "Revisar c√≥digo",
  "description": "Revisar PR #123",
  "priority": "HIGH",
  "dueDate": "2025-10-30",
  "creatorId": 1,
  "assignedMemberIds": [2, 3]
}

# Listar tarefas
GET /pangeia/teams/:teamId/tasks?status=PENDING&priority=HIGH

# Obter tarefa
GET /pangeia/tasks/:taskId

# Atualizar tarefa
PUT /pangeia/tasks/:taskId

# Atualizar status
PATCH /pangeia/tasks/:taskId/status
{
  "status": "COMPLETED",
  "changedById": 1,
  "comment": "Tarefa finalizada com sucesso"
}

# Atribuir membros
POST /pangeia/tasks/:taskId/assign
{
  "memberIds": [2, 3]
}

# Adicionar coment√°rio
POST /pangeia/tasks/:taskId/comments
{
  "authorId": 1,
  "content": "√ìtimo trabalho!"
}

# Listar coment√°rios
GET /pangeia/tasks/:taskId/comments

# Deletar tarefa
DELETE /pangeia/tasks/:taskId
```

#### Relat√≥rios

```http
# Estat√≠sticas da equipe
GET /pangeia/teams/:teamId/statistics

# Tarefas em atraso
GET /pangeia/teams/:teamId/overdue

# Estat√≠sticas do membro
GET /pangeia/members/:memberId/statistics

# Tarefas do membro
GET /pangeia/members/:memberId/tasks?status=PENDING
```

## üèóÔ∏è Arquitetura

### Estrutura de Pastas

```
src/pangeia/
‚îú‚îÄ‚îÄ dto/                    # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ team.dto.ts        # DTOs de equipe e membros
‚îÇ   ‚îî‚îÄ‚îÄ task.dto.ts        # DTOs de tarefas
‚îú‚îÄ‚îÄ services/              # Camada de neg√≥cios
‚îÇ   ‚îú‚îÄ‚îÄ team.service.ts    # Gest√£o de equipes
‚îÇ   ‚îú‚îÄ‚îÄ task.service.ts    # Gest√£o de tarefas
‚îÇ   ‚îú‚îÄ‚îÄ agent.service.ts   # Processador conversacional
‚îÇ   ‚îî‚îÄ‚îÄ message-handler.service.ts  # Integra√ß√£o WhatsApp
‚îú‚îÄ‚îÄ controllers/           # Controladores da API
‚îÇ   ‚îî‚îÄ‚îÄ pangeia.controller.ts
‚îî‚îÄ‚îÄ routers/              # Rotas da API
    ‚îî‚îÄ‚îÄ pangeia.router.ts
```

### Banco de Dados

#### Modelos Principais

**Team** - Equipes
- id, name, description, active
- Relacionamentos: members[], tasks[]

**TeamMember** - Membros da equipe
- id, whatsappJid, name, role (LEADER/ASSIGNED)
- Relacionamentos: team, assignedTasks[], createdTasks[]

**Task** - Tarefas
- id, title, description, status, priority, dueDate
- Relacionamentos: team, creator, assignments[], comments[]

**TaskAssignment** - Atribui√ß√µes
- id, taskId, memberId

**TaskComment** - Coment√°rios
- id, content, taskId, authorId

**TaskStatusHistory** - Hist√≥rico de status
- id, previousStatus, newStatus, taskId, changedById

### Fluxo de Processamento

1. **Mensagem recebida** no WhatsApp
2. **whatsapp.service.ts** detecta mensagem
3. **PangeiaMessageHandler** verifica se √© para o agente
4. **PangeiaAgentService** processa comando via NLP
5. **TeamService/TaskService** executa a√ß√£o no banco
6. **Resposta enviada** via WhatsApp

## üì± Exemplos de Uso

### Exemplo 1: Criar e Atribuir Tarefa

**Usu√°rio (L√≠der):**
```
/pangeia criar tarefa Implementar tela de login
```

**Pangeia:**
```
‚úÖ Tarefa criada com sucesso!

üìù #15 - Implementar tela de login
üìä Status: Pendente
‚≠ê Prioridade: M√©dia
üë§ Criador: Jo√£o Silva

Para atribuir a algu√©m, use:
/pangeia atribuir tarefa #15 para [nome]
```

**Usu√°rio:**
```
/pangeia atribuir tarefa #15 para Maria
```

**Pangeia:**
```
‚úÖ Tarefa #15 atribu√≠da a Maria Santos!
```

### Exemplo 2: Acompanhar Progresso

**Usu√°rio:**
```
/pangeia minhas tarefas
```

**Pangeia:**
```
üìã Minhas Tarefas

‚è≥ #15 - Implementar tela de login
   üü° MEDIUM üìÖ 30/10/2025

üöÄ #12 - Revisar c√≥digo do backend
   üî¥ URGENT

üìä Resumo
Pendentes: 1 | Em andamento: 1 | Conclu√≠das: 8
```

### Exemplo 3: Relat√≥rio da Equipe

**Usu√°rio (L√≠der):**
```
/pangeia relat√≥rio
```

**Pangeia:**
```
üìä Relat√≥rio da Equipe Pangeia

üìã Total de tarefas: 45
‚è≥ Pendentes: 12
üöÄ Em andamento: 8
‚úÖ Conclu√≠das: 23
‚è∏Ô∏è Em espera: 1
‚ùå Canceladas: 1

Gerado em 24/10/2025 15:30
```

### Exemplo 4: Alertas de Atraso

**Usu√°rio (L√≠der):**
```
/pangeia atrasadas
```

**Pangeia:**
```
‚ö†Ô∏è Tarefas em Atraso

‚ö†Ô∏è #10 - Atualizar documenta√ß√£o
   üë§ Pedro Costa | üìÖ 3 dia(s) em atraso

‚ö†Ô∏è #8 - Corrigir bug de autentica√ß√£o
   üë§ N√£o atribu√≠da | üìÖ 5 dia(s) em atraso

Total: 2 tarefa(s)
```

## üîß Personaliza√ß√£o

### Alterar Nome da Equipe Padr√£o

No arquivo `src/pangeia/services/agent.service.ts`:

```typescript
private readonly DEFAULT_TEAM_NAME = 'Pangeia'; // Altere aqui
```

### Adicionar Novos Comandos

No m√©todo `identifyIntent()` do `agent.service.ts`, adicione novos padr√µes:

```typescript
{
  pattern: /^seu\s+padr√£o\s+aqui$/,
  intent: 'seu_intent',
  confidence: 0.9,
  extractor: (match) => ({ /* suas entities */ }),
}
```

E implemente o handler:

```typescript
private async handleSeuIntent(member: any, entities: any): Promise<string> {
  // Sua l√≥gica aqui
  return 'Resposta ao usu√°rio';
}
```

## üé® Emojis Usados

- üìã Tarefas
- ‚è≥ Pendente
- üöÄ Em progresso
- ‚úÖ Conclu√≠da
- ‚ùå Cancelada
- ‚è∏Ô∏è Em espera
- üîµ Prioridade Baixa
- üü° Prioridade M√©dia
- üü† Prioridade Alta
- üî¥ Urgente
- üëë L√≠der
- üë§ Encarregado
- üí¨ Coment√°rio
- üìä Estat√≠sticas
- ‚ö†Ô∏è Alerta

## üêõ Troubleshooting

### Bot n√£o responde

1. Verifique se a mensagem come√ßa com `/pangeia`
2. Confirme que o banco de dados foi migrado
3. Verifique os logs: `tail -f logs/app.log`

### Erro ao criar tarefa

1. Verifique se o membro est√° cadastrado na equipe
2. Confirme que a equipe Pangeia existe no banco
3. Verifique permiss√µes do banco de dados

### Comandos n√£o s√£o reconhecidos

1. Use exatamente os padr√µes documentados
2. Verifique se n√£o h√° caracteres especiais extras
3. Tente o comando de ajuda: `/pangeia ajuda`

## üìù Licen√ßa

Copyright ¬© 2025 Pangeia Team. Todos os direitos reservados.
Licensed under the Apache License, Version 2.0

## ü§ù Contribuindo

Este sistema foi desenvolvido como parte do whatsapp-api. Para contribuir:

1. Fork o reposit√≥rio
2. Crie uma branch para sua feature
3. Commit suas mudan√ßas
4. Push para a branch
5. Abra um Pull Request

## üìû Suporte

Para suporte e d√∫vidas:
- Abra uma issue no GitHub
- Consulte a documenta√ß√£o do whatsapp-api
- Use o comando `/pangeia ajuda` no WhatsApp

---

**Desenvolvido com ‚ù§Ô∏è pela Equipe Pangeia**
